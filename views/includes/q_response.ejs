<div class="w3-panel"></div>

<div class="w3-row-padding" ng-app="myApp">
  <!-- Left Column -->
  <div class="w3-col s12" ng-controller="MainCtrl">
    <div class="w3-card-4">
      <div class="w3-container w3-teal">
        <h5>Подтверждение запроса</h5>
      </div>
      <% const url = '/api/q/res/'+qq._id+';confirm' %>
        <% const url2 = '/api/q/res/'+qq._id+';cancel' %>
      <% const curr = ['','призм','долларов','руб.']; %>
      <% if(qq.class == 1){%>
      <form action="<%= url %>" method="post" class="w3-container">
        <input hidden name="q_ID" value="<%= qq._id%>">
        <h3>
          <p>
            Переведите <%= qq.amount %> <%= curr[qq.currency] %> на номер <%= qq.bank_name%> :
            <br> <%= qq.bank_number %>
            <% if(qq.bank_cod == 0){%>
            <br><span>Public key: </span>
            <br><span><%= qq.bank_publicKey%></span>
            <%}%>
          </p>
          <p>
            <b>Внимание:</b><br>
            В комментарии к переводу вставьте номер:<br>
            <h2><b><%= qq.cod %></b></h2>
          </p>
        </h3>
        <p>
          <input class="w3-btn w3-teal" type="submit" value="ДА, Я ВЫПОЛНИЛ ПЕРЕВОД">
          <div class="w3-right-align"><span><a href="<%= url2 %>">отменить</a> </span></div>
        </p>
        <p>
          <span >Отмена через {{ counter }} сек.</span>
        </p>
      </form>
      <%} else {%>
      <form action="<%= url %>" method="post" class="w3-container">
        <input hidden name="q_ID" value="<%= qq._id%>">
        <h3>
          <p>
            Подтвердите вывод средств <%= qq.amount %> <%= curr[qq.currency] %> на номер <%= qq.bank_name%> :
            <br> <%= qq.bank_number %>
              <% if(qq.bank_cod == 0){%>
            <br><span>Public key: </span>
            <br><span><%= qq.bank_publicKey%></span>
              <%}%>
          </p>
        </h3>
        <p>
          <input class="w3-btn w3-teal" type="submit" value="Подтвердить">
        <div class="w3-right-align"><span><a href="<%= url2 %>">отменить</a> </span></div>
        </p>
        <p>
          <span >Отмена через {{ counter }} сек.</span>
        </p>
      </form>

      <%}%>
    </div>
  </div>
</div>

<script type="text/javascript">
    //<![CDATA[
    let myApp = angular.module('myApp',[]);
    myApp.controller('MainCtrl', function($scope, $timeout) {
        $scope.counter = 0;
        let i = 0;
        let updateCounter = function() {
            $scope.counter = 600 - i;
            i++;
            if (i == 600) {
                window.location.href='<%= url2 %>';
            }
            $timeout(updateCounter, 1000);
        };
        updateCounter();
    });
    //]]>
</script>